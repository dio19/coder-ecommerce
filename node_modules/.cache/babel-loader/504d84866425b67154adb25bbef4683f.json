{"ast":null,"code":"var _jsxFileName = \"/home/laptop19/coder-ecommerce/src/components/Cart/Cart.js\";\nimport React, { useContext, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { getFirestore } from '../../firebase';\nimport * as firebase from 'firebase/app';\nimport { CartContext } from '../../context/CartContext';\nimport CartItem from '../CartItem/CartItem';\nimport Button from '../Button/Button';\nimport Input from '../Input/Input';\nimport Spinner from '../Spinner/Spinner';\nimport Modal from '../Modal/Modal';\nimport './Cart.css';\nexport default function Cart() {\n  const {\n    cart,\n    cartLength,\n    cartPrice,\n    dropCart\n  } = useContext(CartContext);\n  const [formData, setFormData] = useState({\n    name: '',\n    lastname: '',\n    phone: '',\n    email: '',\n    emailConfirm: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [modal, setModal] = useState({\n    title: '',\n    body: ''\n  });\n\n  const validateFormFieldsSize = () => {\n    for (let prop in formData) {\n      if (formData[prop].length === 0) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  const validateEmail = () => {\n    if (formData.email !== formData.emailConfirm) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const updateStock = boughtProducts => {\n    const db = getFirestore();\n    const batch = db.batch();\n    let itemRef;\n\n    for (let prod of boughtProducts) {\n      itemRef = db.collection(\"items\").doc(prod.id);\n      batch.update(itemRef, {\n        stock: firebase.firestore.FieldValue.increment(-prod.cant)\n      });\n    }\n\n    return batch.commit();\n  };\n\n  const confirmarCompra = () => {\n    if (!validateEmail()) {\n      setModal({\n        title: 'Verifica los datos del formulario:',\n        body: 'Los emails ingresados no coinciden'\n      });\n      document.getElementById('cartModalTrigger').click();\n      return;\n    }\n\n    setLoading(true);\n    const db = getFirestore();\n    const orders = db.collection(\"orders\");\n    let newOrder = {\n      buyer: {\n        name: formData.name,\n        lastname: formData.lastname,\n        phone: Number(formData.phone),\n        email: formData.email\n      },\n      items: cart.map(item => {\n        return {\n          cant: item.cant,\n          id: item.prod.id,\n          price: item.prod.price,\n          title: item.prod.title\n        };\n      }),\n      date: firebase.firestore.Timestamp.fromDate(new Date()),\n      total: cartPrice(),\n      status: \"generada\"\n    };\n    updateStock(newOrder.items).then(() => {\n      console.log(\"El stock se actualizo correctamente\");\n      return orders.add(newOrder);\n    }).then(newDoc => {\n      setModal({\n        title: 'Gracias por tu compra',\n        body: `El ID de tu Orden es ${newDoc.id}`\n      });\n    }).catch(error => {\n      console.log(\"Hubo un error al generar la orden o actualizar el stock\", error);\n    }).finally(() => {\n      setFormData({\n        name: '',\n        lastname: '',\n        phone: '',\n        email: '',\n        emailConfirm: ''\n      });\n      dropCart();\n      setLoading(false);\n      document.getElementById('cartModalTrigger').click();\n    });\n  };\n\n  const updateState = event => {\n    let newValue = event.target.value;\n\n    switch (event.target.id) {\n      case 'nameInput':\n        setFormData(prevData => ({ ...prevData,\n          name: newValue\n        }));\n        break;\n\n      case 'lastnameInput':\n        setFormData(prevData => ({ ...prevData,\n          lastname: newValue\n        }));\n        break;\n\n      case 'phoneInput':\n        setFormData(prevData => ({ ...prevData,\n          phone: newValue\n        }));\n        break;\n\n      case 'emailInput':\n        setFormData(prevData => ({ ...prevData,\n          email: newValue\n        }));\n        break;\n\n      case 'emailConfirmInput':\n        setFormData(prevData => ({ ...prevData,\n          emailConfirm: newValue\n        }));\n        break;\n\n      default:\n        console.log('There\\'s not a handler for the provided input');\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex flex-column justify-content-center align-content-center m-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }\n  }, loading ? /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 28\n    }\n  }) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal, {\n    id: \"cartModal\",\n    triggerId: \"cartModalTrigger\",\n    title: modal.title,\n    body: modal.body,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"cartHeader\",\n    className: \"p-3 welcomeCard rounded shadow flex-grow-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 21\n    }\n  }, \"Carrito de Compras\")), cartLength() > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex flex-wrap justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex flex-column flex-grow-1 mx-2 my-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 21\n    }\n  }, cart.map(item => /*#__PURE__*/React.createElement(CartItem, {\n    item: item,\n    key: item.prod.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"total\",\n    className: \"welcomeCard d-flex rounded p-3 mt-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 29\n    }\n  }, \"TOTAL\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex flex-column ml-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"productCount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 33\n    }\n  }, \"$\", cartPrice())))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"checkout\",\n    className: \"align-self-center d-flex flex-column flex-grow-1 mx-2 my-4 p-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    className: \"align-self-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 25\n    }\n  }, \"CHECKOUT\"), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"checkoutForm\",\n    className: \"pt-4 my-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    type: \"text\",\n    label: \"Nombre:\",\n    id: \"nameInput\",\n    data: formData.name,\n    changeAction: updateState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    type: \"text\",\n    label: \"Apellido:\",\n    id: \"lastnameInput\",\n    data: formData.lastname,\n    changeAction: updateState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    type: \"number\",\n    label: \"Telefono:\",\n    id: \"phoneInput\",\n    data: formData.phone,\n    changeAction: updateState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    type: \"email\",\n    label: \"Email:\",\n    id: \"emailInput\",\n    data: formData.email,\n    changeAction: updateState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    type: \"email\",\n    label: \"Repite tu Email:\",\n    id: \"emailConfirmInput\",\n    data: formData.emailConfirm,\n    changeAction: updateState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    label: \"Realizar Compra\",\n    action: confirmarCompra,\n    disabled: !validateFormFieldsSize(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 29\n    }\n  }))) : /*#__PURE__*/React.createElement(\"div\", {\n    id: \"emptyCartMsg\",\n    className: \"mt-5 d-flex flex-column card mx-auto align-self-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 54\n    }\n  }, \"Tu carrito esta vacio\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    label: \"Elegi tu estilo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 33\n    }\n  }))))));\n}","map":{"version":3,"sources":["/home/laptop19/coder-ecommerce/src/components/Cart/Cart.js"],"names":["React","useContext","useState","Link","getFirestore","firebase","CartContext","CartItem","Button","Input","Spinner","Modal","Cart","cart","cartLength","cartPrice","dropCart","formData","setFormData","name","lastname","phone","email","emailConfirm","loading","setLoading","modal","setModal","title","body","validateFormFieldsSize","prop","length","validateEmail","updateStock","boughtProducts","db","batch","itemRef","prod","collection","doc","id","update","stock","firestore","FieldValue","increment","cant","commit","confirmarCompra","document","getElementById","click","orders","newOrder","buyer","Number","items","map","item","price","date","Timestamp","fromDate","Date","total","status","then","console","log","add","newDoc","catch","error","finally","updateState","event","newValue","target","value","prevData"],"mappings":"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","sourcesContent":["import React, {useContext, useState} from 'react';\nimport {Link} from 'react-router-dom';\nimport {getFirestore} from '../../firebase';\nimport * as firebase from 'firebase/app';\n\nimport {CartContext} from '../../context/CartContext';\nimport CartItem from '../CartItem/CartItem';\nimport Button from '../Button/Button';\nimport Input from '../Input/Input';\nimport Spinner from '../Spinner/Spinner';\nimport Modal from '../Modal/Modal';\n\nimport './Cart.css';\n\nexport default function Cart() {\n\n    const {cart, cartLength, cartPrice, dropCart} = useContext(CartContext);\n    const [formData, setFormData] = useState({name:'', lastname:'', phone: '', email: '', emailConfirm: ''});\n    const [loading, setLoading] = useState(false);\n    const [modal, setModal] = useState({title: '', body: ''});\n\n    const validateFormFieldsSize = () => {\n\n        for (let prop in formData){\n            if (formData[prop].length === 0) {\n                return false;\n            }\n        }\n\n        return true;\n\n    }\n\n    const validateEmail = () => {\n\n        if (formData.email !== formData.emailConfirm) {\n            return false;\n        }\n\n        return true;\n\n    }\n\n    const updateStock = ( boughtProducts ) => {\n\n        const db = getFirestore();\n        const batch = db.batch();\n        let itemRef;\n\n        for (let prod of boughtProducts) {\n            itemRef = db.collection(\"items\").doc(prod.id);\n            batch.update (itemRef, {\n                stock: firebase.firestore.FieldValue.increment(-prod.cant)\n            });\n        }\n\n        return batch.commit();\n    }\n\n    const confirmarCompra = () => {\n\n        if (!validateEmail()) {\n            setModal({title: 'Verifica los datos del formulario:', body: 'Los emails ingresados no coinciden'});\n            document.getElementById('cartModalTrigger').click();\n            return;\n        }\n\n        setLoading (true);\n\n        const db = getFirestore();\n        const orders = db.collection(\"orders\");\n\n        let newOrder = {\n            buyer: {\n                name: formData.name,\n                lastname: formData.lastname,\n                phone: Number(formData.phone),\n                email: formData.email\n            },\n            items: cart.map (\n                item => {return {\n                    cant: item.cant,\n                    id: item.prod.id,\n                    price: item.prod.price,\n                    title: item.prod.title\n                }}\n            ),\n            date: firebase.firestore.Timestamp.fromDate(new Date()),\n            total: cartPrice(),\n            status: \"generada\"\n        }\n\n        updateStock(newOrder.items).then(() => {\n            console.log (\"El stock se actualizo correctamente\");\n            return orders.add(newOrder);\n        }).then( newDoc => {\n            setModal({title: 'Gracias por tu compra', body: `El ID de tu Orden es ${newDoc.id}`});\n        }).catch (error => {\n            console.log(\"Hubo un error al generar la orden o actualizar el stock\", error);\n        }).finally (()=> {\n            setFormData({name:'', lastname:'', phone: '', email: '', emailConfirm: ''});\n            dropCart();\n            setLoading (false);\n            document.getElementById('cartModalTrigger').click();\n        });\n\n    }\n\n    const updateState = (event) => {\n        let newValue = event.target.value;\n        switch (event.target.id) {\n            case 'nameInput':\n                setFormData ( prevData => ({...prevData, name: newValue}));\n                break;\n            case 'lastnameInput':\n                setFormData ( prevData => ({...prevData, lastname: newValue}));\n                break;\n            case 'phoneInput':\n                setFormData ( prevData => ({...prevData, phone: newValue}));\n                break;\n            case 'emailInput':\n                setFormData ( prevData => ({...prevData, email: newValue}));\n                break;\n            case 'emailConfirmInput':\n                setFormData ( prevData => ({...prevData, emailConfirm: newValue}));\n                break;\n            default:\n                console.log ('There\\'s not a handler for the provided input');\n        }\n    }\n\n    return (\n            <div className=\"d-flex flex-column justify-content-center align-content-center m-4\">\n\n                {loading ? <Spinner/> :\n\n                    <>\n\n                    <Modal id=\"cartModal\" triggerId=\"cartModalTrigger\" title={modal.title} body={modal.body}/>\n\n                    <div id=\"cartHeader\" className=\"p-3 welcomeCard rounded shadow flex-grow-1\">\n                    <h2>Carrito de Compras</h2>\n                    </div>\n\n                    {cartLength() > 0 ? \n                    <div className=\"d-flex flex-wrap justify-content-center\">\n                    <div className=\"d-flex flex-column flex-grow-1 mx-2 my-4\">\n                        {cart.map ((item) => \n                            <CartItem item={item} key={item.prod.id}></CartItem>\n                        )}\n                        <div id=\"total\" className=\"welcomeCard d-flex rounded p-3 mt-auto\">\n                            <div className=\"\">TOTAL</div>\n                            <div className=\"d-flex flex-column ml-auto\">\n                                <span className=\"productCount\">${cartPrice()}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div id=\"checkout\" className=\"align-self-center d-flex flex-column flex-grow-1 mx-2 my-4 p-4\">\n                        <h5 className=\"align-self-center\">CHECKOUT</h5>\n                        <div id=\"checkoutForm\" className=\"pt-4 my-3\">\n                            <Input type=\"text\" label=\"Nombre:\" id=\"nameInput\" data={formData.name} changeAction={updateState}></Input>\n                            <Input type=\"text\" label=\"Apellido:\" id=\"lastnameInput\" data={formData.lastname} changeAction={updateState}></Input>\n                            <Input type=\"number\" label=\"Telefono:\" id=\"phoneInput\" data={formData.phone} changeAction={updateState}></Input>\n                            <Input type=\"email\" label=\"Email:\" id=\"emailInput\" data={formData.email} changeAction={updateState}></Input>\n                            <Input type=\"email\" label=\"Repite tu Email:\" id=\"emailConfirmInput\" data={formData.emailConfirm} changeAction={updateState}></Input>\n                        </div>\n                            <Button label=\"Realizar Compra\" action={confirmarCompra} disabled={!validateFormFieldsSize()}/>\n                    </div>\n                    </div>\n                    :\n\n                    <div id=\"emptyCartMsg\" className=\"mt-5 d-flex flex-column card mx-auto align-self-center\">\n                        <div className=\"card-header\"><h4 className=\"text-center\">Tu carrito esta vacio</h4></div>\n                        <div className=\"card-body m-auto\">\n                            <Link to=\"/\">\n                                <Button label=\"Elegi tu estilo\"></Button>\n                            </Link>\n                        </div>\n                    </div>\n                    \n                    }\n                    </>\n\n                }\n\n\n            </div>        \n    )\n}\n"]},"metadata":{},"sourceType":"module"}